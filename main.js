// Automatic Table Of Contents 1.7.3 (https://github.com/johansatge)
var d=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var g=d((pe,T)=>{var L=class{},w={},b=class{},k=class{},S=class{},x=class{},M=i=>i;if(R()){let i=require("obsidian");L=i.Plugin,w=i.MarkdownRenderer,b=i.MarkdownRenderChild,k=i.PluginSettingTab,S=i.Setting,x=i.SettingGroup,M=i.htmlToMarkdown}T.exports={Plugin:L,MarkdownRenderer:w,MarkdownRenderChild:b,PluginSettingTab:k,Setting:S,SettingGroup:x,htmlToMarkdown:M};function R(){return typeof process!="object"?!0:!process.env||!process.env.JEST_WORKER_ID}});var f=d((ke,I)=>{var j={title:"",style:"nestedList",minLevel:0,maxLevel:0,include:null,exclude:null,includeLinks:!0,hideWhenEmpty:!1,debugInConsole:!1};I.exports={DEFAULT_OPTIONS:j}});var O=d((Se,C)=>{var{DEFAULT_OPTIONS:u}=f(),o={title:{type:"string",default:u.title,comment:""},style:{type:"value",default:u.style,values:["nestedList","nestedOrderedList","inlineFirstLevel"],comment:"TOC style (nestedList|nestedOrderedList|inlineFirstLevel)"},minLevel:{type:"number",default:u.minLevel,comment:"Include headings from the specified level"},maxLevel:{type:"number",default:u.maxLevel,comment:"Include headings up to the specified level"},include:{type:"regexp",default:null,comment:""},exclude:{type:"regexp",default:null,comment:""},includeLinks:{type:"boolean",default:u.includeLinks,comment:"Make headings clickable"},hideWhenEmpty:{type:"boolean",default:u.hideWhenEmpty,comment:"Hide TOC if no headings are found"},debugInConsole:{type:"boolean",default:!1,comment:"Print debug info in Obsidian console"}};C.exports={getOptionsDocs:U,parseOptionsFromSourceText:G};function U(){let i=[];for(let e of Object.keys(o)){let t=o[e],l=t.comment.length>0?` # ${t.comment}`:"",n=t.default!==null?t.default:"";i.push(`${e}: ${n}${l}`)}return i.join(`
`)}function G(i="",e=null){let t={};if(e)t.title=e.defaultTitle,t.style=e.defaultStyle,t.minLevel=e.defaultMinLevel,t.maxLevel=e.defaultMaxLevel,t.includeLinks=e.defaultIncludeLinks,t.hideWhenEmpty=e.defaultHideWhenEmpty,t.include=o.include.default,t.exclude=o.exclude.default,t.debugInConsole=o.debugInConsole.default;else for(let l of Object.keys(o))t[l]=o[l].default;for(let l of i.split(`
`)){let n=B(l);n!==null&&(t[n.name]=n.value)}return t}function B(i){let e=i.match(/([a-zA-Z0-9._ ]+):(.*)/);if(i.startsWith("#")||!e)return null;let t=e[1].trim(),l=o[t],n=e[2].trim();(!l||!["string","regexp"].includes(l.type))&&(n=n.replace(/#[^#]*$/,"").trim());let s=new Error(`Invalid value for \`${t}\``);if(l&&l.type==="number"){let a=Number.parseInt(n);if(a<0)throw s;return{name:t,value:a}}if(l&&l.type==="boolean"){if(!["true","false"].includes(n))throw s;return{name:t,value:n==="true"}}if(l&&l.type==="value"){if(!l.values.includes(n))throw s;return{name:t,value:n}}if(l&&l.type==="string")return n==="null"||n==='""'||n==="''"?{name:t,value:""}:{name:t,value:n};if(l&&l.type==="regexp"){if(n==="null"||n.length===0)return null;try{let a=/^\/(.*)\/([a-z]*)/.exec(n);if(!a)throw new Error("Invalid regexp");let r=new RegExp(a[1],a[2]);return{name:t,value:r}}catch{throw s}}return null}});var D=d((xe,N)=>{var{htmlToMarkdown:z}=g();N.exports={isHeadingAllowed:J,getFormattedMarkdownHeading:K};function J(i,e){return e.include?e.include.test(i):e.exclude?!e.exclude.test(i):!0}function K(i,e){if(e.includeLinks){let t=i;t=E(t),t=Z(t),t=$(t,!1);let l=i;return l=$(l,!0),l=Q(l),`[[#${l}|${t}]]`}return i}function E(i){return i.replaceAll("*","").replaceAll(/(\W|^)_+(\S)(.*?\S)?_+(\W|$)/g,"$1$2$3$4").replaceAll("`","").replaceAll("==","").replaceAll("~~","").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1")}function Z(i){return E(z(i))}function $(i,e){return i.replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,e?"$1 $2":"$2").replace(/\[\[([^\]]+)\]\]/g,"$1").replaceAll("[[","").replaceAll("| ",e?"":"- ").replaceAll("|",e?" ":"-")}function Q(i){return i.replaceAll("#"," ")}});var W=d((Me,A)=>{var{isHeadingAllowed:F,getFormattedMarkdownHeading:H}=D();A.exports={getMarkdownFromHeadings:X};function X(i,e){let t={nestedList:Y,nestedOrderedList:ee,inlineFirstLevel:te},l="";if(e.title&&e.title.length>0){let s=e.style==="inlineFirstLevel"?" ":`
`;l+=`${e.title}${s}`}let n=t[e.style](i,e);return n===null?e.hideWhenEmpty?"":`${l}_Table of contents: no headings found_`:l+n}function Y(i,e){return P(i,!1,e)}function ee(i,e){return P(i,!0,e)}function P(i,e,t){let l=e?"1.":"-",n=[],s=t.minLevel>0?t.minLevel:Math.min(...i.map(r=>r.level)),a=0;for(let r of i)if(!(a>0&&r.level>a)){if(r.level<=a&&(a=0),!F(r.heading,t)){a=r.level;continue}r.level<s||t.maxLevel>0&&r.level>t.maxLevel||r.heading.length!==0&&n.push(`${"	".repeat(r.level-s)}${l} ${H(r.heading,t)}`)}return n.length>0?n.join(`
`):null}function te(i,e){let t=e.minLevel>0?e.minLevel:Math.min(...i.map(n=>n.level)),l=i.filter(n=>n.level===t).filter(n=>n.heading.length>0).filter(n=>F(n.heading,e)).map(n=>H(n.heading,e));return l.length>0?l.join(" | "):null}});var V=d((Ie,_)=>{var{PluginSettingTab:ne,Setting:Te,SettingGroup:ie}=g(),{DEFAULT_OPTIONS:c}=f(),le={defaultTitle:c.title,defaultStyle:c.style,defaultMinLevel:c.minLevel,defaultMaxLevel:c.maxLevel,defaultIncludeLinks:c.includeLinks,defaultHideWhenEmpty:c.hideWhenEmpty},m=class extends ne{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=document.createDocumentFragment();t.createDiv({cls:"setting-item-name",text:"Default options"}),t.createDiv({cls:"setting-item-description",text:"Configure default options. They can be overridden per codeblock when inserting the table of contents in a page."}),new ie(e).setHeading(t).addSetting(l=>l.setName("Title").setDesc("Title to display before the table of contents (supports Markdown). Use empty string for no title.").addText(n=>n.setPlaceholder("").setValue(this.plugin.settings.defaultTitle).onChange(async s=>{this.plugin.settings.defaultTitle=s,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Style").setDesc("Table of contents style").addDropdown(n=>n.addOption("nestedList","Nested List").addOption("nestedOrderedList","Nested Ordered List").addOption("inlineFirstLevel","Inline First Level").setValue(this.plugin.settings.defaultStyle).onChange(async s=>{this.plugin.settings.defaultStyle=s,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Minimum level").setDesc("Include headings from the specified level (0 for no limit)").addText(n=>n.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMinLevel)).onChange(async s=>{let a=Number.parseInt(s);!Number.isNaN(a)&&a>=0?(this.plugin.settings.defaultMinLevel=a,await this.plugin.saveSettings()):n.setValue(String(this.plugin.settings.defaultMinLevel))}))).addSetting(l=>l.setName("Maximum level").setDesc("Include headings up to the specified level (0 for no limit)").addText(n=>n.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMaxLevel)).onChange(async s=>{let a=Number.parseInt(s);!Number.isNaN(a)&&a>=0?(this.plugin.settings.defaultMaxLevel=a,await this.plugin.saveSettings()):n.setValue(String(this.plugin.settings.defaultMaxLevel))}))).addSetting(l=>l.setName("Include links").setDesc("Make headings clickable by default").addToggle(n=>n.setValue(this.plugin.settings.defaultIncludeLinks).onChange(async s=>{this.plugin.settings.defaultIncludeLinks=s,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Hide when empty").setDesc("Hide table of contents if no headings are found by default").addToggle(n=>n.setValue(this.plugin.settings.defaultHideWhenEmpty).onChange(async s=>{this.plugin.settings.defaultHideWhenEmpty=s,await this.plugin.saveSettings()})))}};_.exports={DEFAULT_SETTINGS:le,SettingsTab:m}});var{Plugin:se,MarkdownRenderer:q,MarkdownRenderChild:ae}=g(),{getOptionsDocs:re,parseOptionsFromSourceText:oe}=O(),{getMarkdownFromHeadings:de}=W(),{DEFAULT_SETTINGS:ue,SettingsTab:ce}=V(),y="table-of-contents",ge="toc",p=class extends se{async onload(){await this.loadSettings();let e=(t,l,n)=>{n.addChild(new v(this.app,l,n.sourcePath,t,this.settings))};this.registerMarkdownCodeBlockProcessor(y,e),this.registerMarkdownCodeBlockProcessor(ge,e),this.addCommand({id:"insert-automatic-table-of-contents",name:"Insert table of contents",editorCallback:he}),this.addCommand({id:"insert-automatic-table-of-contents-docs",name:"Insert table of contents (with available options)",editorCallback:fe}),this.addSettingTab(new ce(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},ue,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};function he(i){let e=`\`\`\`${y}
\`\`\``;i.replaceRange(e,i.getCursor())}function fe(i){let e=[`\`\`\`${y}
${re()}
\`\`\``];i.replaceRange(e.join(`
`),i.getCursor())}var v=class extends ae{constructor(e,t,l,n,s){super(t),this.app=e,this.element=t,this.sourcePath=l,this.sourceText=n,this.pluginSettings=s}onload(){this.render(),this.registerEvent(this.app.metadataCache.on("changed",e=>{e.path===this.sourcePath&&this.onMetadataChange()}))}onMetadataChange(){this.render()}render(){try{let e=oe(this.sourceText,this.pluginSettings);e.debugInConsole&&h("Options",e);let t=this.app.metadataCache.getCache(this.sourcePath),l=t?.headings?t.headings:[];e.debugInConsole&&h("Headings",l);let n=de(l,e);e.debugInConsole&&h("Markdown",n),this.element.empty(),q.renderMarkdown(n,this.element,this.sourcePath,this)}catch(e){h("Error",e);let t=`_\u{1F4A5} Could not render table of contents (${e.message})_`;q.renderMarkdown(t,this.element,this.sourcePath,this)}}};function h(i,e){console.log(`%cAutomatic Table Of Contents %c${i}:
`,"color: orange; font-weight: bold","font-weight: bold",e)}module.exports=p;
