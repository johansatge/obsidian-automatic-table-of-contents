// Automatic Table Of Contents 1.7.3 (https://github.com/johansatge)
"use strict";var d=(i,e)=>()=>(e||i((e={exports:{}}).exports,e),e.exports);var h=d((ye,I)=>{"use strict";var b=class{},x={},S=class{},M=class{},T=class{},O=class{},C=i=>i;if(U()){let i=require("obsidian");b=i.Plugin,x=i.MarkdownRenderer,S=i.MarkdownRenderChild,M=i.PluginSettingTab,T=i.Setting,O=i.SettingGroup,C=i.htmlToMarkdown}I.exports={Plugin:b,MarkdownRenderer:x,MarkdownRenderChild:S,PluginSettingTab:M,Setting:T,SettingGroup:O,htmlToMarkdown:C};function U(){return typeof process!="object"?!0:!process.env||!process.env.JEST_WORKER_ID}});var m=d((Me,$)=>{"use strict";var G={title:"",style:"nestedList",minLevel:0,maxLevel:0,include:null,exclude:null,includeLinks:!0,hideWhenEmpty:!1,debugInConsole:!1};$.exports={DEFAULT_OPTIONS:G}});var E=d((Te,N)=>{"use strict";var{DEFAULT_OPTIONS:u}=m(),g={title:{type:"string",default:u.title,comment:""},style:{type:"value",default:u.style,values:["nestedList","nestedOrderedList","nestedDetailedOrderedList","inlineFirstLevel"],comment:"TOC style (nestedList|nestedOrderedList|nestedDetailedOrderedList|inlineFirstLevel)"},minLevel:{type:"number",default:u.minLevel,comment:"Include headings from the specified level"},maxLevel:{type:"number",default:u.maxLevel,comment:"Include headings up to the specified level"},include:{type:"regexp",default:null,comment:""},exclude:{type:"regexp",default:null,comment:""},includeLinks:{type:"boolean",default:u.includeLinks,comment:"Make headings clickable"},hideWhenEmpty:{type:"boolean",default:u.hideWhenEmpty,comment:"Hide TOC if no headings are found"},debugInConsole:{type:"boolean",default:!1,comment:"Print debug info in Obsidian console"}};N.exports={getOptionsDocs:B,parseOptionsFromSourceText:z};function B(){let i=[];for(let e of Object.keys(g)){let n=g[e],l=n.comment.length>0?` # ${n.comment}`:"",t=n.default!==null?n.default:"";i.push(`${e}: ${t}${l}`)}return i.join(`
`)}function z(i="",e=null){let n={};for(let l of Object.keys(g))n[l]=g[l].default;e&&(n.title=e.defaultTitle,n.style=e.defaultStyle,n.minLevel=e.defaultMinLevel,n.maxLevel=e.defaultMaxLevel,n.includeLinks=e.defaultIncludeLinks,n.hideWhenEmpty=e.defaultHideWhenEmpty);for(let l of i.split(`
`)){let t=J(l);t!==null&&(n[t.name]=t.value)}return n}function J(i){let e=i.match(/([a-zA-Z0-9._ ]+):(.*)/);if(i.startsWith("#")||!e)return null;let n=e[1].trim(),l=g[n],t=e[2].trim();(!l||!["string","regexp"].includes(l.type))&&(t=t.replace(/#[^#]*$/,"").trim());let a=new Error(`Invalid value for \`${n}\``);if(l&&l.type==="number"){let s=Number.parseInt(t);if(s<0)throw a;return{name:n,value:s}}if(l&&l.type==="boolean"){if(!["true","false"].includes(t))throw a;return{name:n,value:t==="true"}}if(l&&l.type==="value"){if(!l.values.includes(t))throw a;return{name:n,value:t}}if(l&&l.type==="string")return t==="null"||t==='""'||t==="''"?{name:n,value:""}:{name:n,value:t};if(l&&l.type==="regexp"){if(t==="null"||t.length===0)return null;try{let s=/^\/(.*)\/([a-z]*)/.exec(t);if(!s)throw new Error("Invalid regexp");let r=new RegExp(s[1],s[2]);return{name:n,value:r}}catch{throw a}}return null}});var H=d((Oe,F)=>{"use strict";var{htmlToMarkdown:K}=h();F.exports={isHeadingAllowed:Z,getFormattedMarkdownHeading:Q};function Z(i,e){return e.include?e.include.test(i):e.exclude?!e.exclude.test(i):!0}function Q(i,e){if(e.includeLinks){let n=i;n=P(n),n=X(n),n=D(n,!1);let l=i;return l=D(l,!0),l=Y(l),`[[#${l}|${n}]]`}return i}function P(i){return i.replaceAll("*","").replaceAll(/(\W|^)_+(\S)(.*?\S)?_+(\W|$)/g,"$1$2$3$4").replaceAll("`","").replaceAll("==","").replaceAll("~~","").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1")}function X(i){return P(K(i))}function D(i,e){return i.replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,e?"$1 $2":"$2").replace(/\[\[([^\]]+)\]\]/g,"$1").replaceAll("[[","").replaceAll("| ",e?"":"- ").replaceAll("|",e?" ":"-")}function Y(i){return i.replaceAll("#"," ")}});var _=d((Ce,W)=>{"use strict";var{isHeadingAllowed:p,getFormattedMarkdownHeading:v}=H();W.exports={getMarkdownFromHeadings:ee};function ee(i,e){let n={nestedList:te,nestedOrderedList:ne,nestedDetailedOrderedList:ie,inlineFirstLevel:le},l="";if(e.title&&e.title.length>0){let a=e.style==="inlineFirstLevel"?" ":`
`;l+=`${e.title}${a}`}let t=n[e.style](i,e);return t===null?e.hideWhenEmpty?"":`${l}_Table of contents: no headings found_`:l+t}function te(i,e){return A(i,!1,e)}function ne(i,e){return A(i,!0,e)}function ie(i,e){let n=[],l=e.minLevel>0?e.minLevel:Math.min(...i.map(s=>s.level)),t=0,a={};for(let s of i){if(t>0&&s.level>t)continue;if(s.level<=t&&(t=0),!p(s.heading,e)){t=s.level;continue}if(s.level<l||e.maxLevel>0&&s.level>e.maxLevel||s.heading.length===0)continue;for(let o of Object.keys(a))Number.parseInt(o)>s.level&&delete a[o];a[s.level]||(a[s.level]=0),a[s.level]++;let r=[];for(let o=l;o<=s.level;o++)a[o]&&r.push(a[o]);let R=`${r.join(".")}.`;n.push(`${"	".repeat(s.level-l)}${R} ${v(s.heading,e)}`)}return n.length>0?n.join(`
`):null}function A(i,e,n){let l=e?"1.":"-",t=[],a=n.minLevel>0?n.minLevel:Math.min(...i.map(r=>r.level)),s=0;for(let r of i)if(!(s>0&&r.level>s)){if(r.level<=s&&(s=0),!p(r.heading,n)){s=r.level;continue}r.level<a||n.maxLevel>0&&r.level>n.maxLevel||r.heading.length!==0&&t.push(`${"	".repeat(r.level-a)}${l} ${v(r.heading,n)}`)}return t.length>0?t.join(`
`):null}function le(i,e){let n=e.minLevel>0?e.minLevel:Math.min(...i.map(t=>t.level)),l=i.filter(t=>t.level===n).filter(t=>t.heading.length>0).filter(t=>p(t.heading,e)).map(t=>v(t.heading,e));return l.length>0?l.join(" | "):null}});var V=d(($e,j)=>{"use strict";var{PluginSettingTab:se,Setting:Ie,SettingGroup:ae}=h(),{DEFAULT_OPTIONS:c}=m(),re={defaultTitle:c.title,defaultStyle:c.style,defaultMinLevel:c.minLevel,defaultMaxLevel:c.maxLevel,defaultIncludeLinks:c.includeLinks,defaultHideWhenEmpty:c.hideWhenEmpty},L=class extends se{constructor(e,n){super(e,n),this.plugin=n}display(){let{containerEl:e}=this;e.empty();let n=document.createDocumentFragment();n.createDiv({cls:"setting-item-name",text:"Default options"}),n.createDiv({cls:"setting-item-description",text:"Configure default options. They can be overridden per codeblock when inserting the table of contents in a page."}),new ae(e).setHeading(n).addSetting(l=>l.setName("Title").setDesc("Title to display before the table of contents (supports Markdown). Use empty string for no title.").addText(t=>t.setPlaceholder("").setValue(this.plugin.settings.defaultTitle).onChange(async a=>{this.plugin.settings.defaultTitle=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Style").setDesc("Table of contents style").addDropdown(t=>t.addOption("nestedList","Nested List").addOption("nestedOrderedList","Nested Ordered List").addOption("inlineFirstLevel","Inline First Level").setValue(this.plugin.settings.defaultStyle).onChange(async a=>{this.plugin.settings.defaultStyle=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Minimum level").setDesc("Include headings from the specified level (0 for no limit)").addText(t=>t.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMinLevel)).onChange(async a=>{let s=Number.parseInt(a);!Number.isNaN(s)&&s>=0?(this.plugin.settings.defaultMinLevel=s,await this.plugin.saveSettings()):t.setValue(String(this.plugin.settings.defaultMinLevel))}))).addSetting(l=>l.setName("Maximum level").setDesc("Include headings up to the specified level (0 for no limit)").addText(t=>t.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMaxLevel)).onChange(async a=>{let s=Number.parseInt(a);!Number.isNaN(s)&&s>=0?(this.plugin.settings.defaultMaxLevel=s,await this.plugin.saveSettings()):t.setValue(String(this.plugin.settings.defaultMaxLevel))}))).addSetting(l=>l.setName("Include links").setDesc("Make headings clickable").addToggle(t=>t.setValue(this.plugin.settings.defaultIncludeLinks).onChange(async a=>{this.plugin.settings.defaultIncludeLinks=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Hide when empty").setDesc("Hide TOC if no headings are found").addToggle(t=>t.setValue(this.plugin.settings.defaultHideWhenEmpty).onChange(async a=>{this.plugin.settings.defaultHideWhenEmpty=a,await this.plugin.saveSettings()})))}};j.exports={DEFAULT_SETTINGS:re,SettingsTab:L}});var{Plugin:oe,MarkdownRenderer:q,MarkdownRenderChild:de}=h(),{getOptionsDocs:ue,parseOptionsFromSourceText:ce}=E(),{getMarkdownFromHeadings:ge}=_(),{DEFAULT_SETTINGS:he,SettingsTab:fe}=V(),k="table-of-contents",me="toc",y=class extends oe{async onload(){await this.loadSettings();let e=(n,l,t)=>{t.addChild(new w(this.app,l,t.sourcePath,n,this.settings))};this.registerMarkdownCodeBlockProcessor(k,e),this.registerMarkdownCodeBlockProcessor(me,e),this.addCommand({id:"insert-automatic-table-of-contents",name:"Insert table of contents",editorCallback:pe}),this.addCommand({id:"insert-automatic-table-of-contents-docs",name:"Insert table of contents (with available options)",editorCallback:ve}),this.addSettingTab(new fe(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},he,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};function pe(i){let e=`\`\`\`${k}
\`\`\``;i.replaceRange(e,i.getCursor())}function ve(i){let e=[`\`\`\`${k}
${ue()}
\`\`\``];i.replaceRange(e.join(`
`),i.getCursor())}var w=class extends de{constructor(e,n,l,t,a){super(n),this.app=e,this.element=n,this.sourcePath=l,this.sourceText=t,this.pluginSettings=a}onload(){this.render(),this.registerEvent(this.app.metadataCache.on("changed",e=>{e.path===this.sourcePath&&this.onMetadataChange()}))}onMetadataChange(){this.render()}render(){try{let e=ce(this.sourceText,this.pluginSettings);e.debugInConsole&&f("Options",e);let n=this.app.metadataCache.getCache(this.sourcePath),l=n?.headings?n.headings:[];e.debugInConsole&&f("Headings",l);let t=ge(l,e);e.debugInConsole&&f("Markdown",t),this.element.empty(),q.renderMarkdown(t,this.element,this.sourcePath,this)}catch(e){f("Error",e);let n=`_\u{1F4A5} Could not render table of contents (${e.message})_`;q.renderMarkdown(n,this.element,this.sourcePath,this)}}};function f(i,e){console.log(`%cAutomatic Table Of Contents %c${i}:
`,"color: orange; font-weight: bold","font-weight: bold",e)}module.exports=y;
