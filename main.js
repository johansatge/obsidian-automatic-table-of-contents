// Automatic Table Of Contents 1.7.3 (https://github.com/johansatge)
"use strict";var p=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var F=Object.prototype.hasOwnProperty;var N=(i,e)=>{for(var n in e)p(i,n,{get:e[n],enumerable:!0})},A=(i,e,n,l)=>{if(e&&typeof e=="object"||typeof e=="function")for(let t of D(e))!F.call(i,t)&&t!==n&&p(i,t,{get:()=>e[t],enumerable:!(l=$(e,t))||l.enumerable});return i};var W=i=>A(p({},"__esModule",{value:!0}),i);var X={};N(X,{default:()=>Q});module.exports=W(X);var h=class{},u={},v=class{},y=class{},_=class{},b=class{},L=i=>i;if(R())try{let i=require("obsidian");h=i.Plugin,u=i.MarkdownRenderer,v=i.MarkdownRenderChild,y=i.PluginSettingTab,_=i.Setting,b=i.SettingGroup||class{},L=i.htmlToMarkdown}catch{}function R(){return typeof process!="object"?!0:!process.env||!process.env.JEST_WORKER_ID}function c(i,e){return e.include?e.include.test(i):e.exclude?!e.exclude.test(i):!0}function g(i,e){if(e.includeLinks){let n=i;n=C(n),n=j(n),n=x(n,!1);let l=i;return l=x(l,!0),l=V(l),`[[#${l}|${n}]]`}return i}function C(i){return i.replaceAll("*","").replaceAll(/(\W|^)_+(\S)(.*?\S)?_+(\W|$)/g,"$1$2$3$4").replaceAll("`","").replaceAll("==","").replaceAll("~~","").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1")}function j(i){return C(L(i))}function x(i,e){return i.replace(/\[\[([^\]]+)\|([^\]]+)\]\]/g,e?"$1 $2":"$2").replace(/\[\[([^\]]+)\]\]/g,"$1").replaceAll("[[","").replaceAll("| ",e?"":"- ").replaceAll("|",e?" ":"-")}function V(i){return i.replaceAll("#"," ")}function S(i,e){let n={nestedList:U,nestedOrderedList:G,nestedDetailedOrderedList:B,inlineFirstLevel:z},l="";if(e.title&&e.title.length>0){let a=e.style==="inlineFirstLevel"?" ":`
`;l+=`${e.title}${a}`}let t=n[e.style](i,e);return t===null?e.hideWhenEmpty?"":`${l}_Table of contents: no headings found_`:l+t}function U(i,e){return M(i,!1,e)}function G(i,e){return M(i,!0,e)}function B(i,e){let n=[],l=e.minLevel>0?e.minLevel:Math.min(...i.map(s=>s.level)),t=0,a={};for(let s of i){if(t>0&&s.level>t)continue;if(s.level<=t&&(t=0),!c(s.heading,e)){t=s.level;continue}if(s.level<l||e.maxLevel>0&&s.level>e.maxLevel||s.heading.length===0)continue;for(let d of Object.keys(a))Number.parseInt(d)>s.level&&delete a[Number.parseInt(d)];a[s.level]||(a[s.level]=0),a[s.level]++;let r=[];for(let d=l;d<=s.level;d++)a[d]&&r.push(a[d]);let H=`${r.join(".")}.`;n.push(`${"	".repeat(s.level-l)}${H} ${g(s.heading,e)}`)}return n.length>0?n.join(`
`):null}function M(i,e,n){let l=e?"1.":"-",t=[],a=n.minLevel>0?n.minLevel:Math.min(...i.map(r=>r.level)),s=0;for(let r of i)if(!(s>0&&r.level>s)){if(r.level<=s&&(s=0),!c(r.heading,n)){s=r.level;continue}r.level<a||n.maxLevel>0&&r.level>n.maxLevel||r.heading.length!==0&&t.push(`${"	".repeat(r.level-a)}${l} ${g(r.heading,n)}`)}return t.length>0?t.join(`
`):null}function z(i,e){let n=e.minLevel>0?e.minLevel:Math.min(...i.map(t=>t.level)),l=i.filter(t=>t.level===n).filter(t=>t.heading.length>0).filter(t=>c(t.heading,e)).map(t=>g(t.heading,e));return l.length>0?l.join(" | "):null}var o={title:"",style:"nestedList",minLevel:0,maxLevel:0,include:null,exclude:null,includeLinks:!0,hideWhenEmpty:!1,debugInConsole:!1};var O={title:{type:"string",default:o.title,comment:""},style:{type:"value",default:o.style,values:["nestedList","nestedOrderedList","nestedDetailedOrderedList","inlineFirstLevel"],comment:"TOC style (nestedList|nestedOrderedList|nestedDetailedOrderedList|inlineFirstLevel)"},minLevel:{type:"number",default:o.minLevel,comment:"Include headings from the specified level"},maxLevel:{type:"number",default:o.maxLevel,comment:"Include headings up to the specified level"},include:{type:"regexp",default:null,comment:""},exclude:{type:"regexp",default:null,comment:""},includeLinks:{type:"boolean",default:o.includeLinks,comment:"Make headings clickable"},hideWhenEmpty:{type:"boolean",default:o.hideWhenEmpty,comment:"Hide TOC if no headings are found"},debugInConsole:{type:"boolean",default:!1,comment:"Print debug info in Obsidian console"}};function P(){let i=[];for(let e of Object.keys(O)){let n=O[e],l=n.comment.length>0?` # ${n.comment}`:"",t=n.default!==null?n.default:"";i.push(`${e}: ${t}${l}`)}return i.join(`
`)}function I(i="",e=null){let n={title:o.title,style:o.style,minLevel:o.minLevel,maxLevel:o.maxLevel,include:o.include,exclude:o.exclude,includeLinks:o.includeLinks,hideWhenEmpty:o.hideWhenEmpty,debugInConsole:o.debugInConsole};e&&(n.title=e.defaultTitle,n.style=e.defaultStyle,n.minLevel=e.defaultMinLevel,n.maxLevel=e.defaultMaxLevel,n.includeLinks=e.defaultIncludeLinks,n.hideWhenEmpty=e.defaultHideWhenEmpty);for(let l of i.split(`
`)){let t=K(l);t!==null&&(n[t.name]=t.value)}return n}function K(i){let e=i.match(/([a-zA-Z0-9._ ]+):(.*)/);if(i.startsWith("#")||!e)return null;let n=e[1].trim(),l=O[n],t=e[2].trim();(!l||!["string","regexp"].includes(l.type))&&(t=t.replace(/#[^#]*$/,"").trim());let a=new Error(`Invalid value for \`${n}\``);if(l&&l.type==="number"){let s=Number.parseInt(t);if(s<0)throw a;return{name:n,value:s}}if(l&&l.type==="boolean"){if(!["true","false"].includes(t))throw a;return{name:n,value:t==="true"}}if(l&&l.type==="value"){if(l.values&&!l.values.includes(t))throw a;return{name:n,value:t}}if(l&&l.type==="string")return t==="null"||t==='""'||t==="''"?{name:n,value:""}:{name:n,value:t};if(l&&l.type==="regexp"){if(t==="null"||t.length===0)return null;try{let s=/^\/(.*)\/([a-z]*)/.exec(t);if(!s)throw new Error("Invalid regexp");let r=new RegExp(s[1],s[2]);return{name:n,value:r}}catch{throw a}}return null}var E={defaultTitle:o.title,defaultStyle:o.style,defaultMinLevel:o.minLevel,defaultMaxLevel:o.maxLevel,defaultIncludeLinks:o.includeLinks,defaultHideWhenEmpty:o.hideWhenEmpty},m=class extends y{constructor(e,n){super(e,n),this.plugin=n}display(){let{containerEl:e}=this;e.empty();let n=document.createDocumentFragment();n.createDiv({cls:"setting-item-name",text:"Default options"}),n.createDiv({cls:"setting-item-description",text:"Configure default options. They can be overridden per codeblock when inserting the table of contents in a page."}),new b(e).setHeading(n).addSetting(l=>l.setName("Title").setDesc("Title to display before the table of contents (supports Markdown). Use empty string for no title.").addText(t=>t.setPlaceholder("").setValue(this.plugin.settings.defaultTitle).onChange(async a=>{this.plugin.settings.defaultTitle=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Style").setDesc("Table of contents style").addDropdown(t=>t.addOption("nestedList","Nested List").addOption("nestedOrderedList","Nested Ordered List").addOption("nestedDetailedOrderedList","Nested Detailed Ordered List").addOption("inlineFirstLevel","Inline First Level").setValue(this.plugin.settings.defaultStyle).onChange(async a=>{this.plugin.settings.defaultStyle=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Minimum level").setDesc("Include headings from the specified level (0 for no limit)").addText(t=>t.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMinLevel)).onChange(async a=>{let s=Number.parseInt(a);!Number.isNaN(s)&&s>=0?(this.plugin.settings.defaultMinLevel=s,await this.plugin.saveSettings()):t.setValue(String(this.plugin.settings.defaultMinLevel))}))).addSetting(l=>l.setName("Maximum level").setDesc("Include headings up to the specified level (0 for no limit)").addText(t=>t.setPlaceholder("0").setValue(String(this.plugin.settings.defaultMaxLevel)).onChange(async a=>{let s=Number.parseInt(a);!Number.isNaN(s)&&s>=0?(this.plugin.settings.defaultMaxLevel=s,await this.plugin.saveSettings()):t.setValue(String(this.plugin.settings.defaultMaxLevel))}))).addSetting(l=>l.setName("Include links").setDesc("Make headings clickable").addToggle(t=>t.setValue(this.plugin.settings.defaultIncludeLinks).onChange(async a=>{this.plugin.settings.defaultIncludeLinks=a,await this.plugin.saveSettings()}))).addSetting(l=>l.setName("Hide when empty").setDesc("Hide TOC if no headings are found").addToggle(t=>t.setValue(this.plugin.settings.defaultHideWhenEmpty).onChange(async a=>{this.plugin.settings.defaultHideWhenEmpty=a,await this.plugin.saveSettings()})))}};var w="table-of-contents",q="toc",T=class extends h{async onload(){await this.loadSettings();let e=(n,l,t)=>{t.addChild(new k(this.app,l,t.sourcePath,n,this.settings))};this.registerMarkdownCodeBlockProcessor(w,e),this.registerMarkdownCodeBlockProcessor(q,e),this.addCommand({id:"insert-automatic-table-of-contents",name:"Insert table of contents",editorCallback:J}),this.addCommand({id:"insert-automatic-table-of-contents-docs",name:"Insert table of contents (with available options)",editorCallback:Z}),this.addSettingTab(new m(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},E,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};function J(i,e){let n=`\`\`\`${w}
\`\`\``;i.replaceRange(n,i.getCursor())}function Z(i,e){let n=[`\`\`\`${w}
${P()}
\`\`\``];i.replaceRange(n.join(`
`),i.getCursor())}var k=class extends v{constructor(e,n,l,t,a){super(n),this.app=e,this.element=n,this.sourcePath=l,this.sourceText=t,this.pluginSettings=a}onload(){this.render(),this.registerEvent(this.app.metadataCache.on("changed",e=>{e.path===this.sourcePath&&this.onMetadataChange()}))}onMetadataChange(){this.render()}render(){try{let e=I(this.sourceText,this.pluginSettings);e.debugInConsole&&f("Options",e);let n=this.app.metadataCache.getCache(this.sourcePath),l=n?.headings?n.headings:[];e.debugInConsole&&f("Headings",l);let t=S(l,e);e.debugInConsole&&f("Markdown",t),this.element.empty(),u.renderMarkdown(t,this.element,this.sourcePath,this)}catch(e){f("Error",e);let l=`_\u{1F4A5} Could not render table of contents (${e instanceof Error?e.message:String(e)})_`;u.renderMarkdown(l,this.element,this.sourcePath,this)}}};function f(i,e){console.log(`%cAutomatic Table Of Contents %c${i}:
`,"color: orange; font-weight: bold","font-weight: bold",e)}var Q=T;
